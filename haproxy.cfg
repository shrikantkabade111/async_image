global
    log stdout format raw local0
    log stdout format raw local1 notice
    #chroot /var/lib/haproxy
    # stats socket /var/run/haproxy.sock mode 660 level admin expose-fd listeners
    stats timeout 30s
    daemon

listen stats
    bind *:8081
    mode http
    stats enable
    stats uri /stats
    stats auth admin:password
    stats refresh 10s
    timeout connect 10s
    timeout client 1m
    timeout server 1m

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000

frontend api_frontend
    bind *:80
    default_backend api_backend

backend api_backend
    balance roundrobin
    option httpchk GET /docs
    http-check expect status 200
    
    # Static server configuration
    server api1 api1:8000 check
    server api2 api2:8001 check
    server api3 api3:8002 check

# Dynamic configuration can be achieved through:
# 1. HAProxy Runtime API (requires enabling stats socket)
# 2. Consul Template (monitors Consul service registry)
# 3. Custom script that updates the config and reloads HAProxy 

